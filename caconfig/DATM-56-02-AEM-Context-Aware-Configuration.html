<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia 2.0.0
 Rendered using Reflow Maven Skin 1.3.4 (https://github.com/wcm-io/wcm-io-tooling/tree/develop/maven/skins/reflow-maven-skin)
-->
<html xml:lang="en" lang="en">

  <head>
    <meta charset="UTF-8" />
    <title>DATM-56-02 AEM Context-Aware Configuration | CONGA Training</title>

    <link rel="shortcut icon" href="https://wcm.io/images/favicon.ico">
    <link rel="apple-touch-icon" href="https://wcm.io/images/favicon-152.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="wcm.io Training - Training materials for wcm.io and subprojects." />
    <meta http-equiv="content-language" content="en" />

    <link href="https://training.wcm.io/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://training.wcm.io/css/docs.css" rel="stylesheet" />
    <link href="https://training.wcm.io/css/reflow-skin.css" rel="stylesheet" />
    <link href="https://training.wcm.io/css/highlightjs-style-github.min.css" rel="stylesheet" />

    <link href="https://training.wcm.io/css/lightbox.css" rel="stylesheet" />

    <link href="https://training.wcm.io/css/site.css" rel="stylesheet" />
    <link href="https://training.wcm.io/css/print.css" rel="stylesheet" media="print" />

  </head>

  <body class="page-datm-56-02-aem-context-aware-configuration project-io.wcm.training.caconfig" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target" id="body">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../..">wcm.io Training</a>
          <div class="nav-collapse collapse" id="top-nav-collapse">
            <ul class="nav pull-right">
              <li ><a href="http://github.com/wcm-io-training" title="GitHub project" class="externalLink">GitHub project</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Trainings <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="../../conga/" title="CONGA">CONGA</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="https://wcm.io/contribute.html" title="Contribute" class="externalLink">Contribute</a></li>
                  <li ><a href="https://github.com/wcm-io-training" title="Issues" class="externalLink">Issues</a></li>
                  <li ><a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a></li>
                  <li ><a href="https://wcm.io/mailing-lists.html" title="Mailing Lists" class="externalLink">Mailing Lists</a></li>
                  <li ><a href="http://github.com/wcm-io-training" title="Fork on GitHub" class="externalLink">Fork on GitHub</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  <div class="container">

  <!-- Masthead
  ================================================== -->

  <header>
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="span12">
        <div class="pull-left">
          <a href="../../" id="bannerLeft"><h1><img src='https://wcm.io/images/favicon-16@3x.png'/> wcm.io Training</h1></a>
          <p class="lead">Training materials for wcm.io and subprojects.</p>
        </div>
        <div class="pull-right">
        </div>
      </div>
    </div>
  </div>
    <div>
      <ul class="breadcrumb">
        <li><a href="../../" title="wcm.io Training">wcm.io Training</a></li>
        <li class="divider">/</li>
        <li><a href="index.html" title="CONGA Training">CONGA Training</a></li>
        <li class="divider">/</li>
        <li>DATM-56-02 AEM Context-Aware Configuration</li>
      </ul>
    </div>
  </header>

  <div class="main-body">
  <div class="row">
    <div class="span8">
      <div class="body-content">
<section>
 <section>
  <a id="DATM-56-02_AEM_Context-Aware_Configuration"></a>
  <div class="page-header">
   <h2 id="datm-56-02_aem_context-aware_configuration">DATM-56-02 AEM Context-Aware Configuration</h2>
  </div>
  <section>
   <a id="Overview"></a>
   <h3 id="overview">Overview</h3>
   <ul>
    <li>Configure Context Path Strategy and Persistence Strategy</li>
    <li>Define configuration metadata and custom widget</li>
    <li>Store configuration in tools/config page (only for German market)</li>
   </ul>
  </section>
  <section>
   <a id="Git_project"></a>
   <h3 id="git_project">Git project</h3>
   <ul>
    <li><a href="https://github.com/wcm-io-training/training-caconfig-exercise-aem" class="externalLink">https://github.com/wcm-io-training/training-caconfig-exercise-aem</a></li>
   </ul>
  </section>
  <section>
   <a id="Introduction"></a>
   <h3 id="introduction">Introduction</h3>
   <p>Deploy the application to your local AEM instance running on port 4502 via the script <code>build-deploy.sh</code>.</p>
   <p>The repository contains a simple AEM application with:</p>
   <ul>
    <li>homepage and a content template showing configuration parameters</li>
    <li>Some simple preconfigured context-aware configuration classes</li>
    <li>Sample content with two simple sites: 
     <ul>
      <li><a href="http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en.html" class="externalLink">http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en.html</a></li>
      <li><a href="http://localhost:4502/content/pv-training-caconfig/tenant-1/germany/de.html" class="externalLink">http://localhost:4502/content/pv-training-caconfig/tenant-1/germany/de.html</a></li>
     </ul></li>
    <li>The Configuration Editor template is also configured: 
     <ul>
      <li><a href="http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en/tools/config.html" class="externalLink">http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en/tools/config.html</a></li>
      <li><a href="http://localhost:4502/content/pv-training-caconfig/tenant-1/germany/de/tools/config.html" class="externalLink">http://localhost:4502/content/pv-training-caconfig/tenant-1/germany/de/tools/config.html</a></li>
     </ul></li>
   </ul>
   <p>There are no context paths configured, so the configuration editor is not functional initially.</p>
  </section>
  <section>
   <a id="Exercise"></a>
   <h3 id="exercise">Exercise</h3>
   <section>
    <a id="A.29_Configure_Context_Path_Strategy_and_Persistence_Strategy"></a>
    <h4 id="a_configure_context_path_strategy_and_persistence_">A) Configure Context Path Strategy and Persistence Strategy</h4>
    <p>Exercise:</p>
    <ol style="list-style-type: decimal;">
     <li>Configure a <a href="https://wcm.io/caconfig/extensions/context-path-strategies.html" class="externalLink">wcm.io Context Path Strategy</a> for levels 1..5 for the template <code>/apps/pv-training/caconfig/templates/homepage</code>
      <ul>
       <li>Derive conf path from content path by replacing “/content” with “/conf”</li>
      </ul></li>
     <li>Configure a <a href="https://wcm.io/caconfig/extensions/persistence-strategies.html" class="externalLink">wcm.io Persistence Strategy</a> for storing configurations as AEM Pages at <code>/conf</code></li>
     <li>Define the configurations for both in <code>config-definition/src/main/templates/pv-training-caconfig-aem-cms/pv-training-caconfig-aem-cms-config.provisioning.hbs</code>
      <ul>
       <li>Keep in mind you have to execute <code>clean_install_deploy_package.sh</code> again to get this configuration active in the AEM instance</li>
      </ul></li>
    </ol>
    <p>Validation:</p>
    <ul>
     <li>Open configuration editor for US page <a href="http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en/tools/config.html" class="externalLink">http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en/tools/config.html</a></li>
     <li>Enter some singleton configuration for “Training CAConfig Site Config” 
      <ul>
       <li>Also enter some configuration data in the nested “Shopping basket” configuration</li>
      </ul></li>
     <li>Enter some configuration collection items for “de.provision.training.caconfig.aem.config.LinkList”</li>
     <li>Ensure that the configuration was stored in the repository at 
      <ul>
       <li><code>/conf/pv-training-caconfig/tenant-1/usa/en/sling:configs/de.provision.training.caconfig.aem.config.SiteConfig/jcr:content</code></li>
       <li><code>/conf/pv-training-caconfig/tenant-1/usa/en/sling:configs/de.provision.training.caconfig.aem.config.LinkList/*/jcr:content</code></li>
      </ul></li>
     <li>Download the sample content via <code>sample-content/sample-content_download.sh</code> you entered to commit it in your training repository</li>
    </ul>
   </section>
   <section>
    <a id="B.29_Define_configuration_metadata_and_custom_widget"></a>
    <h4 id="b_define_configuration_metadata_and_custom_widget">B) Define configuration metadata and custom widget</h4>
    <p>Exercise:</p>
    <ol style="list-style-type: decimal;">
     <li>Edit the configuration definition <code>de.provision.training.caconfig.aem.config.LinkList</code> and add labels and descriptions for the configuration class and for each property</li>
     <li>Define a custom path browser widget for the <a href="https://wcm.io/caconfig/editor/usage.html" class="externalLink">wcm.io Context-Aware Configuraiton Editor</a> with starts with the current configuration context path as root path for the property <code>pagePath</code></li>
    </ol>
    <p>Validation:</p>
    <ul>
     <li>Open the configuration editor for US Page / Link list: <a href="http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en/tools/config.html#/de.provision.training.caconfig.aem.config.LinkList" class="externalLink">http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en/tools/config.html#/de.provision.training.caconfig.aem.config.LinkList</a></li>
     <li>Ensure configuration and property labels and descriptions are displayed</li>
     <li>Click on the browse button beneath the “Page path” field and ensure it allows only to select pages from the current site, e.g. “Page 1” and “Page 2”</li>
    </ul>
   </section>
   <section>
    <a id="C.29_Store_configuration_in_tools.2Fconfig_page_.28only_for_German_market.29"></a>
    <h4 id="c_store_configuration_in_toolsconfig_page_only_for">C) Store configuration in tools/config page (only for German market)</h4>
    <p>Exercise:</p>
    <ol style="list-style-type: decimal;">
     <li>Configure an <strong>additional</strong> <a href="https://wcm.io/caconfig/extensions/persistence-strategies.html" class="externalLink">wcm.io Persistence Strategy</a> for storing configurations as AEM Pages at <code>/tools/config</code> Pages relative to the site root as part of the content 
      <ul>
       <li>This strategy gets only active for context paths with <code>/tools/config</code> in the path</li>
      </ul></li>
     <li>Configure an <strong>additional</strong> <a href="https://wcm.io/caconfig/extensions/context-path-strategies.html" class="externalLink">wcm.io Context Path Strategy</a>: 
      <ul>
       <li>This strategy should only be applied for content/context paths at <code>/content/pv-training-caconfig/tenant-1/germany</code> and below (only the German market)</li>
       <li>This strategy should derive an additional config reference at <code>&lt;context-root-path&gt;/tools/config/jcr:content</code>, e.g. <code>/content/pv-training-caconfig/tenant-1/germany/tools/config/jcr:content</code></li>
       <li>To make sure this strategy has higher precedence for the German market assign it a higher service ranking value than the other strategy</li>
      </ul></li>
     <li>Define the configurations for both in <code>config-definition/src/main/templates/pv-training-caconfig-aem-cms/pv-training-caconfig-aem-cms-config.provisioning.hbs</code>
      <ul>
       <li>Keep in mind you have to execute <code>clean_install_deploy_package.sh</code> again to get this configuration active in the AEM instance</li>
      </ul></li>
    </ol>
    <p>Validation:</p>
    <ul>
     <li>Open the configuration editor for the german site <a href="http://localhost:4502/content/pv-training-caconfig/tenant-1/germany/de/tools/config.html" class="externalLink">http://localhost:4502/content/pv-training-caconfig/tenant-1/germany/de/tools/config.html</a> and enter some singleton configuration and collection configuration data 
      <ul>
       <li>Verify that the configuration data you entered was stored below <code>/content/pv-training-caconfig/tenant-1/germany/de/tools/config/jcr:content/sling:configs</code></li>
       <li>Verify that it was <strong>not</strong> stored below <code>/conf/pv-training-caconfig/tenant-1/germany/de/sling:configs</code></li>
      </ul></li>
     <li>Open the configuration editor for the US site <a href="http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en/tools/config.html" class="externalLink">http://localhost:4502/content/pv-training-caconfig/tenant-1/usa/en/tools/config.html</a> and change and save some configuration data 
      <ul>
       <li>Verify that it was stored below <code>/conf/pv-training-caconfig/tenant-1/usa/en/sling:configs</code></li>
       <li>Verify that it was <strong>not</strong> stored below <code>/content/pv-training-caconfig/tenant-1/usa/en/tools/config/jcr:content/sling:configs</code></li>
      </ul></li>
     <li>You can also open the Context-Aware Configuration web console plugin to debug the context paths and configuration references for each content context path 
      <ul>
       <li><a href="http://localhost:4502/system/console/slingcaconfig?path=%2Fcontent%2Fpv-training-caconfig%2Ftenant-1%2Fusa%2Fen&amp;configName=de.provision.training.caconfig.aem.config.SiteConfig" class="externalLink">http://localhost:4502/system/console/slingcaconfig?path=%2Fcontent%2Fpv-training-caconfig%2Ftenant-1%2Fusa%2Fen&amp;configName=de.provision.training.caconfig.aem.config.SiteConfig</a></li>
       <li><a href="http://localhost:4502/system/console/slingcaconfig?path=%2Fcontent%2Fpv-training-caconfig%2Ftenant-1%2Fgermany%2Fde&amp;configName=de.provision.training.caconfig.aem.config.SiteConfig" class="externalLink">http://localhost:4502/system/console/slingcaconfig?path=%2Fcontent%2Fpv-training-caconfig%2Ftenant-1%2Fgermany%2Fde&amp;configName=de.provision.training.caconfig.aem.config.SiteConfig</a></li>
      </ul></li>
     <li>Download the sample content via <code>sample-content/sample-content_download.sh</code> you entered to commit it in your training repository</li>
    </ul>
   </section>
  </section>
 </section>
</section>
      </div>
    </div>
    <div class="span4">
      <div id="toc-sidebar">
        <div class="well">
          <ul class="nav nav-list">
            <li class="nav-header">Table of Contents</li>
    <li class="dropdown"><a href="#datm-56-02_aem_context-aware_configuration" title="DATM-56-02 AEM Context-Aware Configuration">DATM-56-02 AEM Context-Aware Configuration <b class="caret"></b></a>
      <ul class="nav nav-list">
    <li><a href="#overview" title="Overview">Overview</a>
    <li><a href="#git_project" title="Git project">Git project</a>
    <li><a href="#introduction" title="Introduction">Introduction</a>
    <li class="dropdown"><a href="#exercise" title="Exercise">Exercise <b class="caret"></b></a>
      <ul class="nav nav-list">
    <li><a href="#a_configure_context_path_strategy_and_persistence_" title="A) Configure Context Path Strategy and Persistence Strategy">A) Configure Context Path Strategy and Persistence Strategy</a>
    <li><a href="#b_define_configuration_metadata_and_custom_widget" title="B) Define configuration metadata and custom widget">B) Define configuration metadata and custom widget</a>
    <li><a href="#c_store_configuration_in_toolsconfig_page_only_for" title="C) Store configuration in tools/config page (only for German market)">C) Store configuration in tools/config page (only for German market)</a>
        <li class="divider"></li>
      </ul>
    </li>
      </ul>
    </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  </div>

  </div>

  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Main</li>
            <li >
              <a href="../../" title="Home">Home</a>
            </li>
            <li >
              <a href="https://wcm.io/platforms.html" title="Platforms" class="externalLink">Platforms</a>
            </li>
            <li >
              <a href="https://wcm.io/maven.html" title="Maven Repositories" class="externalLink">Maven Repositories</a>
            </li>
            <li >
              <a href="http://github.com/wcm-io-training" title="GitHub project" class="externalLink">GitHub project</a>
            </li>
            <li >
              <a href="https://wcm.io/subprojects.html" title="Subprojects" class="externalLink">Subprojects</a>
            </li>
            <li >
              <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" title="License" class="externalLink">License</a>
            </li>
            <li >
              <a href="https://wcm.io/commercial-support.html" title="Commercial Support" class="externalLink">Commercial Support</a>
            </li>
            <li >
              <a href="https://diva-e.com/en/imprint/" title="Imprint" class="externalLink">Imprint</a>
            </li>
            <li >
              <a href="https://wcm.io/privacy.html" title="Privacy Policy" class="externalLink">Privacy Policy</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Trainings</li>
            <li >
              <a href="../../conga/" title="CONGA">CONGA</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Contribute</li>
            <li >
              <a href="https://wcm.io/contribute.html" title="Contribute" class="externalLink">Contribute</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io-training" title="Issues" class="externalLink">Issues</a>
            </li>
            <li >
              <a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a>
            </li>
            <li >
              <a href="https://wcm.io/mailing-lists.html" title="Mailing Lists" class="externalLink">Mailing Lists</a>
            </li>
            <li >
              <a href="http://github.com/wcm-io-training" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Maven documentation</li>
            <li >
              <a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-description">
          <blockquote>wcm.io Training provides Training materials for wcm.io and subprojects.</blockquote>
        </div>
      </div>
    </div>
  </footer>

  <div class="container subfooter">
    <div class="row">
      <div class="span12">
        <p class="pull-right"><a href="#body">Back to top</a></p>
        <p class="copyright">Copyright &copy;2017-2025 <a href="https://training.wcm.io">wcm.io Training</a>. All Rights Reserved.</p>
        <p class="version-date"><span class="projectVersion">Version: 1. </span><span class="publishDate">Last Published: 2025-01-13. </span></p>
      </div>
    </div>
  </div>

  <!-- JavaScript
  ================================================== -->
  <script src="https://training.wcm.io/js/jquery.min.js"></script>
  <script src="https://training.wcm.io/js/bootstrap.min.js"></script>
  <script src="https://training.wcm.io/js/lightbox.min.js"></script>
  <script src="https://training.wcm.io/js/reflow-scroll.js"></script>
  <script src="https://training.wcm.io/js/json5.min.js"></script>
  <script src="https://training.wcm.io/js/reflow-json-jcr-convert.js"></script>
  <script src="https://training.wcm.io/js/highlight.min.js"></script>


  <script src="https://training.wcm.io/js/reflow-skin.js"></script>

  </body>
</html>